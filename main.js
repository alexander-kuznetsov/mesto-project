(()=>{"use strict";var t={d:(e,n)=>{for(var o in n)t.o(n,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:n[o]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};function e(t,e,n){e.forEach((function(e){e.validity.valid?function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.remove(n),o.textContent=""}(t,e,n):function(t,e,n){var o=t.querySelector(".".concat(e.id,"-error"));e.classList.add(n),o.textContent=e.validationMessage}(t,e,n)}))}function n(t,e,n){Array.from(t).some((function(t){return!t.validity.valid}))?(e.disabled=!0,e.classList.add(n)):(e.disabled=!1,e.classList.remove(n))}t.d({},{b7:()=>O,au:()=>U,t1:()=>P,Ag:()=>B,xS:()=>k});var o="plus-cohort-2",r="755b9008-e161-4a71-9b33-376d2b5a566b",c="https://nomoreparties.co/v1/",u={authorization:r},a={authorization:r,"Content-Type":"application/json"};function i(t){return t.ok?t.json():Promise.reject("Ошибка, статус: ".concat(t.status,"."))}var l=document.querySelector(".popup_type_image"),s=document.querySelector(".popup_type_profile"),p=document.querySelector(".popup_type_card"),d=document.querySelector(".popup_type_avatar"),f=document.querySelectorAll(".popup"),_=document.querySelector("#place-card").content,v=l.querySelector(".popup__image"),m=l.querySelector(".popup__image-caption");function y(t,e){var n=_.cloneNode(!0);return function(t,e,n){var o=t.querySelector(".place__image"),r=t.querySelector(".place"),c=t.querySelector(".button__like");Array.from(e.likes).some((function(t){return t._id===n}))&&c.classList.add("button__like_active"),o.src=e.link,o.alt=e.name,r.id=e._id,t.querySelector(".place__title").textContent=e.name,t.querySelector(".place__like-count").textContent=Array.from(e.likes).length.toString()}(n,t,e),n.querySelector(".button__like").addEventListener("click",(function(e){var n=e.target,r=n.classList.contains("button__like_active")?"DELETE":"PUT";(function(t,e){return fetch("".concat(c).concat(o,"/cards/likes/").concat(t),{method:e,headers:u}).then((function(t){return i(t)}))})(t._id,r).then((function(t){var e=t._id;document.querySelector("#".concat(CSS.escape(e))).querySelector(".place__like-count").textContent=Array.from(t.likes).length.toString(),n.classList.toggle("button__like_active")})).catch((function(t){return console.log(t)}))})),e!==t.owner._id?n.querySelector(".button__remove").classList.add("button_visible_hidden"):n.querySelector(".button__remove").addEventListener("click",(function(e){var n;(n=t._id,fetch("".concat(c).concat(o,"/cards/").concat(n),{method:"DELETE",headers:u}).then((function(t){return i(t)}))).then((function(){return e.target.closest(".place").remove()})).catch((function(t){return console.log(t)}))})),n.querySelector(".place__image-link").addEventListener("click",(function(e){var n,o;n=t.link,o=t.name,v.src=n,v.alt=o,m.textContent=o,S(l)})),n}var h=document.querySelector(".page");function S(t){h.addEventListener("keydown",b),t.classList.add("popup_opened")}function g(t){h.removeEventListener("keydown",b),t.classList.remove("popup_opened")}function b(t){if("Escape"===t.key){var e=(n=f,Array.from(n).find((function(t){return t.classList.contains("popup_opened")})));null!=e&&g(e)}var n}function q(t){t.target.classList.contains("popup")&&g(t.target)}function E(t){Array.from(t).forEach((function(t){return t.value=""}))}function C(t,e){return Array.from(t).find((function(t){return t.name===e}))}function L(t,e){var n=t.querySelector(".button"),o=n.textContent;n.textContent=e?"".concat(o,"..."):o.substring(0,o.length-3)}var k,A,x={inputSelector:".popup__input",submitButtonSelector:".button",inactiveButtonClass:"button_state_inactive",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},B=document.querySelector(".profile__title"),P=document.querySelector(".profile__subtitle"),O=document.querySelector(".profile__image"),T=document.querySelector(".profile__image-overlay"),F=s.querySelectorAll(".popup__input"),I=d.querySelector(".popup__input"),j=p.querySelectorAll(".popup__input"),D=C(F,"firstFormInput"),w=C(F,"secondFormInput"),N=document.querySelector(".button__edit"),J=document.querySelectorAll(".button__close"),z=document.querySelector(".button__add"),H=s.querySelector(".button__save"),M=p.querySelector(".button__save"),U=document.querySelector(".places");Promise.all([fetch("".concat(c).concat(o,"/users/me"),{headers:u}).then((function(t){return i(t)})),fetch("".concat(c).concat(o,"/cards"),{headers:u}).then((function(t){return i(t)}))]).then((function(t){var e,n=t[0];B.textContent=n.name,P.textContent=n.about,O.src=n.avatar,k=n._id,e=t[1],Array.from(e).forEach((function(t){U.prepend(y(t,k))}))})).catch((function(t){return console.log(t)})),s.addEventListener("submit",(function(t){t.preventDefault();var e,n,r=t.target.querySelectorAll(".popup__input"),u=C(r,"firstFormInput"),l=C(r,"secondFormInput");L(t.target,!0),(e=u.value,n=l.value,fetch("".concat(c).concat(o,"/users/me"),{method:"PATCH",headers:a,body:JSON.stringify({name:e,about:n})}).then((function(t){return i(t)}))).then((function(t){B.textContent=t.name,P.textContent=t.about,g(s)})).catch((function(t){return console.log(t)})).finally((function(){return L(t.target,!1)}))})),p.addEventListener("submit",(function(t){t.preventDefault();var e,n,r=t.target.querySelectorAll(".popup__input"),u=C(r,"firstFormInput"),l=C(r,"secondFormInput");L(t.target,!0),(e=u.value,n=l.value,fetch("".concat(c).concat(o,"/cards"),{method:"POST",headers:a,body:JSON.stringify({name:e,link:n})}).then((function(t){return i(t)}))).then((function(t){U.prepend(y(t,k)),g(p),E(r)})).catch((function(t){return console.log(t)})).finally((function(){return L(t.target,!1)}))})),d.addEventListener("submit",(function(t){t.preventDefault();var e,n=t.target.querySelector(".popup__input");L(t.target,!0),(e=n.value,fetch("".concat(c).concat(o,"/users/me/avatar"),{method:"PATCH",headers:a,body:JSON.stringify({avatar:e})}).then((function(t){return i(t)}))).then((function(t){O.src=n.value,E([n]),g(d)})).catch((function(t){return console.log(t)})).finally((function(){return L(t.target,!1)}))})),N.addEventListener("click",(function(t){D.value=B.textContent,w.value=P.textContent,e(s,F,x.inputErrorClass),n([D,w],H,x.inactiveButtonClass),S(s)})),J.forEach((function(t){t.addEventListener("click",(function(t){g(t.target.closest(".popup"))}))})),z.addEventListener("click",(function(t){n(j,M,x.inactiveButtonClass),S(p)})),T.addEventListener("click",(function(t){n([I],M,x.inactiveButtonClass),S(d)})),f.forEach((function(t){t.addEventListener("click",q)})),A=x,Array.from(document.forms).forEach((function(t){var o=Array.from(t.querySelectorAll(A.inputSelector)),r=t.querySelector(A.submitButtonSelector);n(o,r,A.inactiveButtonClass),o.forEach((function(c){c.addEventListener("input",(function(u){e(t,[c],A.inputErrorClass),n(o,r,A.inactiveButtonClass)}))}))}))})();